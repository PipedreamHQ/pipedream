import app from "../../fortnox.app.mjs";

export default {
  key: "fortnox-list-invoices",
  name: "List Invoices",
  description: "Retrieve a list of invoices in Fortnox. [See the documentation](https://api.fortnox.se/apidocs#tag/fortnox_Invoices/operation/list_20)",
  version: "0.0.1",
  type: "action",
  annotations: {
    destructiveHint: false,
    openWorldHint: true,
    readOnlyHint: true,
  },
  props: {
    app,
    filter: {
      type: "string",
      label: "Filter",
      description: "Filter the invoices",
      options: [
        "cancelled",
        "fullpaid",
        "unpaid",
        "unpaidoverdue",
        "unbooked",
      ],
      optional: true,
    },
    costcenter: {
      type: "string",
      label: "Cost Center",
      description: "Filter the invoices by cost center",
      optional: true,
    },
    customername: {
      type: "string",
      label: "Customer Name",
      description: "Filter the invoices by customer name",
      optional: true,
    },
    customernumber: {
      type: "string",
      label: "Customer Number",
      description: "Filter the invoices by customer number",
      optional: true,
    },
    label: {
      type: "string",
      label: "Label",
      description: "Filter the invoices by label",
      optional: true,
    },
    documentnumber: {
      type: "string",
      label: "Document Number",
      description: "Filter the invoices by document number",
      optional: true,
    },
    fromdate: {
      type: "string",
      label: "From Date",
      description: "Filter the invoices by from date",
      optional: true,
    },
    todate: {
      type: "string",
      label: "To Date",
      description: "Filter the invoices by to date",
      optional: true,
    },
    fromfinalpaydate: {
      type: "string",
      label: "From Final Pay Date",
      description: "Filter the invoices by from final pay date",
      optional: true,
    },
    tofinalpaydate: {
      type: "string",
      label: "To Final Pay Date",
      description: "Filter the invoices by to final pay date",
      optional: true,
    },
    lastmodified: {
      type: "string",
      label: "Last Modified",
      description: "Filter the invoices by last modified",
      optional: true,
    },
    notcompleted: {
      type: "string",
      label: "Not Completed",
      description: "Filter the invoices by not completed",
      optional: true,
    },
    ocr: {
      type: "string",
      label: "OCR",
      description: "Filter the invoices by OCR",
      optional: true,
    },
    ourreference: {
      type: "string",
      label: "Our Reference",
      description: "Filter the invoices by our reference",
      optional: true,
    },
    project: {
      type: "string",
      label: "Project",
      description: "Filter the invoices by project",
      optional: true,
    },
    sent: {
      type: "string",
      label: "Sent",
      description: "Filter the invoices by sent",
      optional: true,
    },
    externalinvoicereference1: {
      type: "string",
      label: "External Invoice Reference 1",
      description: "Filter the invoices by external invoice reference 1",
      optional: true,
    },
    externalinvoicereference2: {
      type: "string",
      label: "External Invoice Reference 2",
      description: "Filter the invoices by external invoice reference 2",
      optional: true,
    },
    yourreference: {
      type: "string",
      label: "Your Reference",
      description: "Filter the invoices by your reference",
      optional: true,
    },
    invoicetype: {
      type: "string",
      label: "Invoice Type",
      description: "Filter the invoices by invoice type",
      optional: true,
    },
    articlenumber: {
      type: "string",
      label: "Article Number",
      description: "Filter the invoices by article number",
      optional: true,
    },
    articledescription: {
      type: "string",
      label: "Article Description",
      description: "Filter the invoices by article description",
      optional: true,
    },
    currency: {
      type: "string",
      label: "Currency",
      description: "Filter the invoices by currency",
      optional: true,
    },
    accountnumberfrom: {
      type: "string",
      label: "Account Number From",
      description: "Filter the invoices by account number from",
      optional: true,
    },
    accountnumberto: {
      type: "string",
      label: "Account Number To",
      description: "Filter the invoices by account number to",
      optional: true,
    },
    credit: {
      type: "string",
      label: "Credit",
      description: "Filter the invoices by credit",
      optional: true,
    },
    sortby: {
      type: "string",
      label: "Sort By",
      description: "Filter the invoices by sort by",
      optional: true,
    },
    sortorder: {
      type: "string",
      label: "Sort Order",
      description: "Filter the invoices by sort order",
      options: [
        "customername",
        "customernumber",
        "documentnumber",
        "invoicedate",
        "ocr",
        "total",
      ],
      optional: true,
    },
  },
  async run({ $ }) {
    const { Invoices } = await this.app.listInvoices({
      $,
      params: {
        filter: this.filter,
        costcenter: this.costcenter,
        customername: this.customername,
        customernumber: this.customernumber,
        label: this.label,
        documentnumber: this.documentnumber,
        fromdate: this.fromdate,
        todate: this.todate,
        fromfinalpaydate: this.fromfinalpaydate,
        tofinalpaydate: this.tofinalpaydate,
        lastmodified: this.lastmodified,
        notcompleted: this.notcompleted,
        ocr: this.ocr,
        ourreference: this.ourreference,
        project: this.project,
        sent: this.sent,
        externalinvoicereference1: this.externalinvoicereference1,
        externalinvoicereference2: this.externalinvoicereference2,
        yourreference: this.yourreference,
        invoicetype: this.invoicetype,
        articlenumber: this.articlenumber,
        articledescription: this.articledescription,
        currency: this.currency,
        accountnumberfrom: this.accountnumberfrom,
        accountnumberto: this.accountnumberto,
        credit: this.credit,
        sortby: this.sortby,
        sortorder: this.sortorder,
      },
    });

    $.export("$summary", `Successfully retrieved ${Invoices.length} invoice${Invoices.length === 1
      ? ""
      : "s"}`);
    return Invoices;
  },
};
