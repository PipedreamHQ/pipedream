import { Tabs } from 'nextra/components'
import Callout from '@/components/Callout'

# Connect Proxy

Pipedream Connect provides a proxy API that you can use to send authenticated requests to any integrated API on behalf of your users, which is useful in a few scenarios:

1. You need code-level control and you want to use [Pipedream's OAuth](/connect/managed-auth/oauth-clients#using-pipedream-oauth) instead of [your own OAuth client](/connect/managed-auth/oauth-clients#using-a-custom-oauth-client)
2. There isn't a [pre-built tool](/connect/components) (action) for the app, or you need to modify the request
3. You want to avoid storing end user credentials in your app

## Overview

The Connect proxy enables you to interface with any integrated API and make authenticated requests on behalf of your users, without dealing with OAuth or storing end user credentials.

- You send a request to the proxy and identify the end user you want to act on behalf of
- The proxy sends the request to the downstream API and dynamically inserts your end user's auth credentials
- The proxy returns the response from the downstream API back to you

[include a diagram here]

<Callout type="info">
Before getting started with the Connect proxy, make sure you've already gone through the [managed auth quickstart](/connect/managed-auth/quickstart) for Pipedream Connect.
</Callout>

## Getting started

You can send requests to the Connect proxy using the [Pipedream SDK](/connect/sdk) with a fetch-style interface, or by making a request to the [REST API](/rest-api/connect/proxy).

- A Pipedream OAuth client to make authenticated requests to Pipedream's API # add a link
- The external user ID for your end user (ex, `abc-123`) # add link
- Connect environment (ex, `production` or `development`) # add link
- The account ID for your end user's connected account (ex, `apn_1234567`) # add a link to accounts endpoint

### Code examples

**URL**

- The URL of the API you want to call (ex, `https://slack.com/api/chat.postMessage`)
- If using the REST API, this should be an URL-safe Base64 encoded string (ex, `aHR0cHM6Ly9zbGFjay5jb20vYXBpL2NoYXQucG9zdE1lc3NhZ2U`)

**HTTP method**

- Use the HTTP method required by the downstream API

**Body**

- Optionally include a body to send to the downstream API

**Headers**

- If using the REST API, include the `Authorization` header with your Pipedream OAuth access token (`Bearer {access_token}`). **This does not get forwarded to the downstream API.**
- Any other headers you include will be forwarded to the downstream API, with the exception of those with the `x-pd-` prefix
- For downstream API headers, don't prepend with anything, and we'll forward them as-is. For example:


<Tabs items={['Node.js', 'HTTP (cURL)']}>

<Tabs.Tab>
```javascript
import { createBackendClient } from "@pipedream/sdk/server";

const pd = createBackendClient({
  environment: {development | production},
  projectId: {your_projectId},
  credentials: {
    clientId: {your_oauth_client_id},
    clientSecret: {your_oauth_client_secret}
  },
});

const url = "https://slack.com/api/chat.postMessage"
const options = {
  account_id: "{account_id}", // The account ID for your end user (ex, apn_1234567)
  external_user_id: "{external_user_id}", // The external user ID for your end user
}

const resp = await pd.makeProxyRequest(
  url,
  options,
  {
  method: "POST",
  body: {
    text: "hello, world",
    channel: "C03NA8B4VA9"
  },
})

// Parse and return the data you need
console.log(resp);
```
</Tabs.Tab>

<Tabs.Tab>
```bash
# First, obtain an OAuth access token
curl -X POST https://api.pipedream.com/v1/oauth/token \
  -H "Content-Type: application/json" \
  -d '{
    "grant_type": "client_credentials",
    "client_id": "{your_oauth_client_id}",
    "client_secret": "{your_oauth_client_secret}"
  }'

# The response will include an access_token. Use it in the Authorization header below.

curl -X POST "https://api.pipedream.com/v1/connect/{your_project_id}/proxy/{url_safe_base64_encoded_url}?external_user_id={external_user_id}&account_id={apn_xxxxxxx}" \
  -H "Authorization: Bearer {access_token}" \
  -H "x-pd-environment: {development | production}" \
  -d '{
    "text": "hello, world",
    "channel": "C03NA8B4VA9"
  }'

# Parse and return the data you need
```
</Tabs.Tab>

</Tabs>