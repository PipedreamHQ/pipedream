import { Callout, Tabs, Steps } from 'nextra/components'

# Using Pipedream MCP with OpenAI

Access {process.env.PUBLIC_APPS}+ APIs and 10,000+ tools in the OpenAI using Pipedream Connect. MCP makes it easy to extend the capabilties of any LLM or agent, and Pipedream offers drop-in support for [calling tools in OpenAI](https://platform.openai.com/docs/guides/tools?api-mode=responses) .

<Callout type="info">
Pipedream Connect includes built-in user authentication for [every MCP server](https://mcp.pipedream.com), which means you don't need to build any authorization flows or deal with token storage and refresh. [Learn more below](#account-connection).
</Callout>

### Getting started

<Steps>

### Set up your environment

To use Pipedream MCP with your own users, you need the following:

1. A [Pipedream account](https://pipedream.com/auth/signup)
2. A [Pipedream project](/projects/#creating-projects) (accounts connected via MCP will be stored here)
3. [Pipedream OAuth credentials](/rest-api/auth/#oauth)

<Callout type="info">
These are requirements for you, the developer. Your users do **not** need to sign up for Pipedream in order to connect their accounts in your app or agent.
</Callout>

Now set the following environment variables (learn more about environments in Pipedream Connect [here](/connect/managed-auth/environments/)):

```bash
PIPEDREAM_CLIENT_ID=your_client_id
PIPEDREAM_CLIENT_SECRET=your_client_secret
PIPEDREAM_PROJECT_ID=your_project_id
PIPEDREAM_ENVIRONMENT=development
OPENAI_API_KEY=your_openai_api_key
```

### Discover available MCP servers

Pipedream provides [{process.env.PUBLIC_APPS}+ APIs as MCP servers](https://mcp.pipedream.com) that can be used with OpenAI's tool calls. Each server corresponds to an app integration (like Notion, Gmail, or Slack) and has its own specific set of tools that you can expose to OpenAI.

<Tabs items={['List all apps', 'Search for a specific app']}>
<Tabs.Tab>
```javascript
// Get all available apps (paginated)
const apps = await pd.getApps();

// Each app has these key properties:
// - name_slug: Used in the MCP server URL (e.g., "notion", "gmail", "slack")
// - name: Display name (e.g., "Notion", "Gmail", "Slack")
```
</Tabs.Tab>
<Tabs.Tab>
```javascript
// Search by app name
const notionApps = await pd.getApps({ q: "notion" });
const gmailApps = await pd.getApps({ q: "gmail" });
const slackApps = await pd.getApps({ q: "slack" });
```
</Tabs.Tab>
</Tabs>

### Generate a model response in OpenAI with Pipedream MCP

Below is an example showing how to:
1. Initialize the Pipedream SDK
2. Identify the right MCP server based on the user's query
3. Get an access token for authorization to Pipedream MCP
4. Send a prompt to OpenAI with the MCP server as a tool call

<Tabs items={['Node.js', 'cURL']}>
<Tabs.Tab> 
```javascript
import OpenAI from 'openai';
import { createBackendClient } from "@pipedream/sdk/server";

// Initialize the Pipedream client with the SDK
const pd = createBackendClient({
  environment: PIPEDREAM_ENVIRONMENT,
  credentials: {
    clientId: PIPEDREAM_CLIENT_ID,
    clientSecret: PIPEDREAM_CLIENT_SECRET,
  },
  projectId: PIPEDREAM_PROJECT_ID
});

// Find the app to use for the MCP server
// For this example, we'll use Notion
const apps = await pd.getApps({ q: "notion" });
const appSlug = apps.data[0].name_slug; // e.g., "notion"

// Get access token for MCP server auth
const accessToken = await pd.rawAccessToken();

// Send the unique ID that you use to identify this user in your system
const externalUserId = 'abc-123'; // Used in MCP URL to identify the user

// Initialize OpenAI client
const client = new OpenAI();

// Make the OpenAI request with the MCP server
const response = await client.responses.create({
  model: 'gpt-4.1',
  tools: [
    {
      type: 'mcp',
      server_label: 'Notion',
      server_url: `https://mcp.pipedream.net/${externalUserId}/${appSlug}`,
      headers: {
        Authorization: `Bearer ${accessToken}`,
        "x-pd-project-id": PIPEDREAM_PROJECT_ID,
        "x-pd-environment": PIPEDREAM_ENVIRONMENT
      },
      require_approval: 'never'
    }
  ],
  input: 'Summarize my most recently created Notion doc for me and help draft an email to our customers'
});

console.log(response);
```
</Tabs.Tab>
<Tabs.Tab>
```bash
# Complete example from start to finish

# Step 1: Get access token from Pipedream
ACCESS_TOKEN=$(curl -s -X POST https://api.pipedream.com/v1/oauth/token \
  -H "Content-Type: application/json" \
  -d '{
    "grant_type": "client_credentials", 
    "client_id": "'$PIPEDREAM_CLIENT_ID'", 
    "client_secret": "'$PIPEDREAM_CLIENT_SECRET'"
  }' | jq -r .access_token)

# Step 2: Find the app to use for MCP server
# Search for the Notion app
APP_SLUG=$(curl -s -X GET "https://api.pipedream.com/v1/apps?q=notion" \
  -H "Authorization: Bearer $ACCESS_TOKEN" | jq -r '.data[0].name_slug')

# Step 3: Make request to OpenAI with MCP tool
curl -X POST https://api.openai.com/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -d '{
    "model": "gpt-4.1",
    "messages": [
      {
        "role": "user",
        "content": "Summarize my most recently created Notion doc for me and help draft an email to our customers"
      }
    ],
    "tools": [
      {
        "type": "mcp",
        "server_label": "Notion",
        "server_url": "https://mcp.pipedream.net/abc-123/'$APP_SLUG'",
        "headers": {
          "Authorization": "Bearer '"$ACCESS_TOKEN"'",
          "x-pd-project-id": "$PIPEDREAM_PROJECT_ID",
          "x-pd-environment": "$PIPEDREAM_ENVIRONMENT"
        },
        "require_approval": "never"
      }
    ]
  }'
```
</Tabs.Tab>
</Tabs> 
</Steps>

## Account Connection

One of the core features of Pipedream Connect and our MCP product is the ability for your users to easily connect their accounts without having to build any of the authorization flow or handle token storage.

You can handle account connections in one of two ways in your app:

### Add a button in your UI
- Use Pipedream's [frontend SDK](/connect/managed-auth/quickstart/#use-the-pipedream-sdk-in-your-frontend) to let users connect their account directly in your UI
- You can see an example of this when you connect any account in [mcp.pipedream.com](https://mcp.pipedream.com)

### Return a link
- Use [Connect Link ](/connect/managed-auth/quickstart/#or-use-connect-link) to let your users open a Pipedream hosted page to connect their account
- There is no implementation required for this option since it's already handled in Pipedream's MCP server
- If a user doesn't have a connected account that's required for a given tool call, we'll return a URL in the tool call response. For example:

```
https://pipedream.com/_static/connect.html?token=ctok_xxxxxxx&connectLink=true&app=notion
```