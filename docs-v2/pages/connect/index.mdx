import Callout from '@/components/Callout'
import { Steps } from 'nextra/components'

# Pipedream Connect

## Overview

Pipedream Connect is the easiest way for your users to connect to any API, **right in your product**.

Connect enables you to easily integrate more than {process.env.PUBLIC_APPS}+ APIs into your product. Your users connect their API accounts for Slack, GitHub, and more, directly in your app. You can then retrieve fresh credentials for any account via API, making authenticated requests on their behalf. Pipedream handles the security of credentials and the whole OAuth flow — no need to manage authorization grants or token refresh yourself. 

Connect includes:

1. A [Client SDK](https://github.com/PipedreamHQ/pipedream/tree/master/packages/sdk) to initiate authorization for any one of the [{process.env.PUBLIC_APPS}+ APIs](https://pipedream.com/apps) available on Pipedream
2. A [REST API](#rest-api-overview) to retrieve credentials (OAuth access tokens, API keys, etc.) for your end users
3. The Pipedream platform and its [serverless runtime](/), [thousands of pre-built source-available triggers and actions](https://github.com/PipedreamHQ/pipedream/tree/master/components), and a first-class developer experience to build, test, and deploy custom workflows

### PUT VIDEO HERE ###

### PUT JASON'S DIAGRAM HERE ###

<Callout type="info">
**Pipedream Connect is currently in preview, and we're looking for feedback!**

**In the preview phase, the API may change without notice. We'll do our best to communicate changes, but please be aware that breaking changes may occur.**

Please [let us know](mailto:connect@pipedream.com) how you're using it, what's not working, and what else you'd like to see.
</Callout>

## Glossary of terms

- **App**: GitHub, Notion, Slack, Google Sheets, and more. The app is the API you want your users to connect to in your product. See the [full list here](https://pipedream.com/apps).
- **Developer**: This is probably you: the Pipedream customer who's developing an app and wants to use Connect to make API requests on behalf of their end users.
- **End User**: Your customer or user, whose data you want to access on their behalf. End users are identifed via the `external_id` param in Pipedream.
- **Connected Account**: The account your end user connects. [Read more about connected accounts](/connected-accounts).
- **OAuth Client**: Custom OAuth clients you create in Pipedream. [Read more about OAuth clients](/connected-accounts/oauth-clients).

## Getting started

<Steps>

### Enable the feature flag

Enable the feature flag for **Pipedream Connect** in your [account settings](https://pipedream.com/settings/alpha).

### Choose the apps you want to integrate

There are two types of apps in Pipedream:

1. **Key-based**: These apps require static credentials, like API keys. Pipedream stores these credentials securely and exposes them via API.
2. **OAuth**: These apps require OAuth authorization. Pipedream manages the OAuth flow for these apps, ensuring you always have a fresh access token for requests.

Connecting Key-based apps with the Pipedream API requires only [the app's name slug](#find-your-apps-name-slug). OAuth apps require you to [create your own OAuth client](#creating-a-custom-oauth-client) and pass the OAuth app ID, as well.

#### Find your app's name slug

1. Visit [https://pipedream.com/apps](https://pipedream.com/apps)
2. Search and select the app you want to integrate
3. In the **Authentication** section, copy the **Name slug**.

Typically, the name slug is the name of the app in lowercase, with spaces replaced by underscores. For example, the name slug for the GitHub app is `github`. The name slug for Google Sheets is `google_sheets`.

**SCREENSHOT**

#### Creating a custom OAuth client

First, [create an OAuth client](/connected-accounts/oauth-clients#configuring-custom-oauth-clients) for the app you'd like to integrate.

<Callout type="warning">
Make sure to check the **Enable for Pipedream Connect** setting in the OAuth client configuration in Pipedream to allow end users to connect their accounts. By default, OAuth clients are accessible only to members of your Pipedream workspace.

**SCREENSHOT**
</Callout>

Once that's done, copy the OAuth app ID from the app configuration.

**SCREEENSHOT**

### Get your project keys

Open an existing Pipedream project or create a new one: [https://pipedream.com/projects](https://pipedream.com/projects).

Find your **Project Public Key** and **Project Secret Key** from the **Connect** tab within your project — you'll need these when configuring the SDK and making API requests.

**SCREENSHOT**

### Add the integration to your app

You'll need to do two things to integrate Pipedream Connect into your app:

1. [Connect to the Pipedream API from your server](#connect-to-the-pipedream-api-from-your-server). This lets you make secure calls to the Pipedream API to initiate the account connection flow and retrieve account credentials. If you're running a JavaScript framework like Node.js on the server, you can use the Pipedream SDK.
2. [Add the Pipedream SDK to your frontend](#add-the-pipedream-sdk-to-your-frontend). This lets you kick off the account connection flow for your end users.

**DEVELOPER FLOW SCREENSHOT**

We'll walk through these steps below, using [a Next.js app](https://github.com/PipedreamHQ/pipedream/tree/master/packages/sdk/examples/next-app/) as an example.

#### Connect to the Pipedream API from your server

<Callout type="info">
**Why do I need to talk to the Pipedream API from my server?**

You need to secure specific operations, for example:

- You need to initiate the account connection flow for your end users. In Pipedream Connect, **you exchange your project keys for a short-lived token that allows a specific user to connect a specific app**, and return that token to your frontend. If you expose your Pipedream project keys directly to the frontend, anyone could initiate the account connection flow for any user, and you'd be charged for those accounts.
- You need to retrieve account credentials for your end users. Again, this should happen securely on your server, not in the frontend, to protect your users' data.

</Callout>

In this Next.js example, we're running Node.js code on our server, via [Next server components](https://nextjs.org/docs/app/building-your-application/rendering/server-components), so we'll use the Pipedream SDK. Additional examples in Python, Ruby, and other languages are noted below.

To install the [Pipedream SDK](https://www.npmjs.com/package/@pipedream/sdk):

```bash
npm i --save @pipedream/sdk
```

To create a short-lived token via SDK, you'll need to create a Pipedream API client and call the `connectTokenCreate` method. In our example app, this logic is in `app/server.ts`. Click into other tabs to see examples in additional languages.

```typescript
import {
  createClient,
  type ConnectTokenCreateOpts,
  type ConnectTokenResponse,
} from "@pipedream/sdk";

const pd = createClient({
  publicKey: PIPEDREAM_PROJECT_PUBLIC_KEY,
  secretKey: PIPEDREAM_PROJECT_SECRET_KEY,
  apiHost: PIPEDREAM_API_HOST,
});

export async function serverConnectTokenCreate(opts: ConnectTokenCreateOpts): Promise<ConnectTokenResponse> {
  return pd.connectTokenCreate(opts);
}
```

In our Next.js app, we call this method [from the frontend](#add-the-pipedream-sdk-to-your-frontend) to initiate the account connection flow **for a specific user, and a specific app**:

```typescript
import { serverConnectTokenCreate } from "./server"

const { token, expires_at } = await serverConnectTokenCreate({
  app_slug: appSlug,  // The app's name slug
  oauth_client_id: oauthAppId,  // The OAuth app ID, if you're connecting an OAuth app
  external_id: externalUserId  // The end user's ID in your system
});
```

If you're using a different server / API framework, you'll need to make secure calls to that API to create a new token for your users. For example, you might validate a user's session, then call the Pipedream API to create a new token for that user.

#### Add the Pipedream SDK to your frontend

Install the [Pipedream SDK](https://www.npmjs.com/package/@pipedream/sdk):

```bash
npm i --save @pipedream/sdk
```

In our example app, `app/page.tsx` imports the SDK and the token creation code we wrote above:

```typescript
// Note that we import the browser-specific SDK client here
import { createClient } from "@pipedream/sdk/browser"
import { serverConnectTokenCreate } from "./server"

const { token, expires_at } = await serverConnectTokenCreate({
  app_slug: appSlug,  // The app's name slug
  oauth_client_id: oauthAppId,  // The OAuth app ID, if you're connecting an OAuth app
  external_id: externalUserId  // The end user's ID in your system
});
```

### Retrieve your user credentials from Pipedream's API

- Check out to the API reference below to retrieve your users' credentials from Pipedream's API after they've connected their account.

## Deploying to production

Once you have the app working locally and want to deploy it to production, you'll need to [verify the domain](/workspaces/domain-verification#pipedream-connect) where the app will be hosted.

</Steps>

## Retrieving account details and user credentials

After your end users have connected their account using Pipedream Connect, you can retrieve their credentials using Pipedream's REST API, which enables you to make authenticated requests on their behalf.

### REST API Overview

<Callout type="warning">
Note that both the Base URL and authentication method for the Connect REST API are different from the rest of Pipedream's REST API.
</Callout>

**Base URL for all Connect requests**
```
https://api.pipedream.com/v1/connect
```

**Authentication**

You authenticate to the Connect REST API using **Basic Auth**. Send your Pipedream [Project Public Key]() as the username and the [Project Secret Key]() as the password. When you make API requests, pass an
`Authorization` header of the following format:

```
Authorization: Basic <Base 64 encoded public_key:secret_key>
```

For example, here's how you can use `cURL` to fetch a list of all accounts in your project:

```shell
curl 'https://api.pipedream.com/v1/connect/accounts' \
  -H 'Authorization: Basic <Base 64 encoded public_key:secret_key>'
```

### API Reference

#### List all accounts

List all connected accounts for all end users within your project

<Callout type="warning">
This endpoint is not currently paginated, so we'll attempt to return all connected accounts for all users within your project. We intend to add pagination soon.
</Callout>

```
GET /accounts/
```

##### Example response

```json
{
  "data": {
    "accounts": [
      {
        "id": "apn_XehyZPr",
        "name": null,
        "external_id": "user-abc-123",
        "healthy": true,
        "dead": false,
        "app": {
          "id": "app_OkrhR1",
          "name": "Slack"
        },
        "created_at": "2024-07-30T22:52:48.000Z",
        "updated_at": "2024-08-01T03:44:17.000Z"
      },
      {
        "id": "apn_b6h9QDK",
        "name": null,
        "external_id": "user-abc-123",
        "healthy": true,
        "dead": false,
        "app": {
          "id": "app_OrZhaO",
          "name": "GitHub"
        },
        "created_at": "2024-07-31T02:49:18.000Z",
        "updated_at": "2024-08-01T03:58:17.000Z"
      },
      {
        "id": "apn_0WhJYxv",
        "name": null,
        "external_id": "user-abc-123",
        "healthy": true,
        "dead": false,
        "app": {
          "id": "app_OrZhaO",
          "name": "GitHub"
        },
        "created_at": "2024-07-31T20:28:16.000Z",
        "updated_at": "2024-08-01T03:47:30.000Z"
      },
      {
        "id": "apn_kVh9PJx",
        "name": null,
        "external_id": "user-abc-123",
        "healthy": true,
        "dead": false,
        "app": {
          "id": "app_OrZhaO",
          "name": "GitHub"
        },
        "created_at": "2024-07-31T21:17:03.000Z",
        "updated_at": "2024-08-01T03:43:23.000Z"
      },
      {
        "id": "apn_WYhMlrz",
        "name": null,
        "external_id": "user-abc-123",
        "healthy": true,
        "dead": false,
        "app": {
          "id": "app_XBxhAl",
          "name": "Airtable"
        },
        "created_at": "2024-08-01T04:04:03.000Z",
        "updated_at": "2024-08-01T04:04:03.000Z"
      }
    ]
  }
}
```

#### List all connected accounts for an app

```
GET /apps/:app_id/accounts
``` 

- `:app_id` can be `oauth_app_id` or `app_id`

##### Example response

```json
[
  {
    "id": "apn_WYhMlrz",
    "name": null,
    "external_id": "user-abc-123",
    "healthy": true,
    "dead": false,
    "app": {
      "id": "oa_aw4ib2",
      "name_slug": "airtable_oauth",
      "name": "Airtable",
      "auth_type": "oauth",
      "description": "Airtable is a low-code platform to build next-gen apps. Move beyond rigid tools, operationalize your critical data, and reimagine workflows with AI.",
      "img_src": "https://assets.pipedream.net/s.v0/app_XBxhAl/logo/orig",
      "custom_fields_json": "[]",
      "categories": ["Productivity"]
    },
    "created_at": "2024-08-01T04:04:03.000Z",
    "updated_at": "2024-08-01T04:04:03.000Z"
  }
]
```

#### Retrieve account details for a specific auth provision

Retrieve the account details for a specific account based on the auth provision

```
GET /accounts/:apn_id
```
- `:apn_id` is the auth provision of the account you want to retrieve
- Optionally include `?include_credentials=1` as a query-string parameter to include the account credentials in the response

##### Example response (without account credentials)

```json
{
  "data": {
    "id": "apn_WYhMlrz",
    "name": null,
    "external_id": "user-abc-123",
    "healthy": true,
    "dead": false,
    "app": {
      "id": "oa_aw4ib2",
      "name_slug": "airtable_oauth",
      "name": "Airtable",
      "auth_type": "oauth",
      "description": "Airtable is a low-code platform to build next-gen apps. Move beyond rigid tools, operationalize your critical data, and reimagine workflows with AI.",
      "img_src": "https://assets.pipedream.net/s.v0/app_XBxhAl/logo/orig",
      "custom_fields_json": "[]",
      "categories": ["Productivity"]
    },
    "created_at": "2024-08-01T04:04:03.000Z",
    "updated_at": "2024-08-01T04:04:03.000Z"
  }
}
```

##### Example Response (with `include_credentials=1`)

```json
{
  "data": {
    "id": "apn_WYhMlrz",
    "name": null,
    "external_id": "user-abc-123",
    "healthy": true,
    "dead": false,
    "app": {
      "id": "app_XBxhAl",
      "name": "Airtable"
    },
    "created_at": "2024-08-01T04:04:03.000Z",
    "updated_at": "2024-08-01T04:04:03.000Z",
    "credentials": {
      "oauth_client_id": "dd7a26ca-ba11-4f80-8667-xxxxxxxx",
      "oauth_access_token": "oaaLa2Ob1umiregWa.v1.xxxxxxxx.xxxxxxxx",
      "oauth_refresh_token": "oaaLa2Ob1umiregWa.v1.refresh.xxxxxxxx",
      "oauth_uid": "usrnbIhrxxxxxxxx"
    },
    "expires_at": "2024-08-01T05:04:03.000Z",
    "project_id": 279440,
    "user_id": "danny",
    "error": null,
    "last_refreshed_at": null,
    "next_refresh_at": "2024-08-01T04:17:33.000Z"
  }
}
```

#### Retrieve account details for a specific external user

Retrieve the account details for a specific account based on the external user ID

```
GET /users/:external_id/accounts
```
- `:external_id` is the end user's ID in the Connect Partner's system
- Optionally include `?include_credentials=1` as a query-string parameter to include the account credentials in the response

##### Example response (without account credentials)

```json
[
  {
    "id": "apn_WYhM5ov",
    "name": null,
    "external_id": "user-abc-123",
    "healthy": true,
    "dead": false,
    "app": {
      "id": "oa_aw4ib2",
      "name_slug": "airtable_oauth",
      "name": "Airtable",
      "auth_type": "oauth",
      "description": "Airtable is a low-code platform to build next-gen apps. Move beyond rigid tools, operationalize your critical data, and reimagine workflows with AI.",
      "img_src": "https://assets.pipedream.net/s.v0/app_XBxhAl/logo/orig",
      "custom_fields_json": "[]",
      "categories": [
        "Productivity"
      ]
    },
    "created_at": "2024-08-06T21:51:30.000Z",
    "updated_at": "2024-08-06T21:51:30.000Z",
    "expires_at": "2024-08-06T22:51:30.000Z",
    "error": null,
    "last_refreshed_at": null,
    "next_refresh_at": "2024-08-06T22:04:41.000Z"
  },
  {
    "id": "apn_KAh7JwW",
    "name": null,
    "external_id": "user-abc-123",
    "healthy": true,
    "dead": false,
    "app": {
      "id": "oa_aPXiQd",
      "name_slug": "github",
      "name": "GitHub",
      "auth_type": "oauth",
      "description": "Where the world builds software. Millions of developers and companies build, ship, and maintain their software on GitHub—the largest and most advanced development platform in the world.",
      "img_src": "https://assets.pipedream.net/s.v0/app_OrZhaO/logo/orig",
      "custom_fields_json": "[]",
      "categories": [
        "Developer Tools"
      ]
    },
    "created_at": "2024-08-06T21:53:05.000Z",
    "updated_at": "2024-08-06T21:53:05.000Z",
    "expires_at": null,
    "error": null,
    "last_refreshed_at": null,
    "next_refresh_at": "2024-08-06T22:50:01.000Z"
  }
]
```

##### Example Response (with `include_credentials=1`)

```json
[
  {
    "id": "apn_WYhM5ov",
    "name": null,
    "external_id": "user-abc-123",
    "healthy": true,
    "dead": false,
    "app": {
      "id": "oa_aw4ib2",
      "name_slug": "airtable_oauth",
      "name": "Airtable",
      "auth_type": "oauth",
      "description": "Airtable is a low-code platform to build next-gen apps. Move beyond rigid tools, operationalize your critical data, and reimagine workflows with AI.",
      "img_src": "https://assets.pipedream.net/s.v0/app_XBxhAl/logo/orig",
      "custom_fields_json": "[]",
      "categories": [
        "Productivity"
      ]
    },
    "created_at": "2024-08-06T21:51:30.000Z",
    "updated_at": "2024-08-06T21:51:30.000Z",
    "credentials": {
      "oauth_client_id": "dd7a26ca-ba11-4f80-8667-xxxxxxxx",
      "oauth_access_token": "oaaLa2Ob1umiregWa.v1.xxxxxxxx.xxxxxxxx",
      "oauth_refresh_token": "oaaLa2Ob1umiregWa.v1.refresh.xxxxxxxx",
      "oauth_uid": "usrnbIhrxxxxxxxx"
    },
    "expires_at": "2024-08-06T22:51:30.000Z",
    "error": null,
    "last_refreshed_at": null,
    "next_refresh_at": "2024-08-06T22:04:41.000Z"
  },
  {
    "id": "apn_KAh7JwW",
    "name": null,
    "external_id": "user-abc-123",
    "healthy": true,
    "dead": false,
    "app": {
      "id": "oa_aPXiQd",
      "name_slug": "github",
      "name": "GitHub",
      "auth_type": "oauth",
      "description": "Where the world builds software. Millions of developers and companies build, ship, and maintain their software on GitHub—the largest and most advanced development platform in the world.",
      "img_src": "https://assets.pipedream.net/s.v0/app_OrZhaO/logo/orig",
      "custom_fields_json": "[]",
      "categories": [
        "Developer Tools"
      ]
    },
    "created_at": "2024-08-06T21:53:05.000Z",
    "updated_at": "2024-08-06T21:53:05.000Z",
    "credentials": {
      "oauth_client_id": "57dc28xxxxxxxxxxxxx",
      "oauth_access_token": "gho_xxxxxxxxxxxxxxxxxx",
      "oauth_uid": "104484339"
    },
    "expires_at": null,
    "error": null,
    "last_refreshed_at": null,
    "next_refresh_at": "2024-08-06T22:50:01.000Z"
  }
]
```

#### Delete individual connected account
Delete a specific connected account for an end user

```
DELETE /v1/connect/accounts/:apn_id
```

- `:apn_id` is the auth provision of the account you want to retrieve
- We'll return a `204 No Content` response if the account was successfully deleted

#### Delete all connected accounts for a specific app

```
/DELETE /apps/:app_id/accounts
```

- `:app_id` can be `oauth_app_id` or `app_id`
- We'll return a `204 No Content` response if the accounts were successfully deleted

#### Delete an end user and all their connected accounts

```
DELETE /users/:external_id
```

- `external_id` refers to the end user's ID in your system — whatever unique identifer you assign to your customers.
- We'll return a `204 No Content` response if the user was successfully deleted

## Plans and pricing

- The core billing model will be based on the number of end users in your Pipedream workspace
- During the preview phase, Pipedream Connect is available to Advanced and Business customers at no additional cost, with a limited number of end users during the preview phase

## Product roadmap for Connect

- Address bugs and feedback during the preview phase
- Invoke Pipedream workflows on behalf of end users
- Improve error handling for Connect developers and end users
- And more