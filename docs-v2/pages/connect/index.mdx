import Callout from '@/components/Callout'
import { Steps } from 'nextra/components'

# Pipedream Connect

<Callout type="info">
Pipedream Connect is currently in **preview** and we're looking for feedback!

**While in the preview phase, the API may change without notice. We'll do our best to communicate any changes, but please be aware that breaking changes may occur.**

Please [let us know](https://pipedream.com/support) how you're using it, what's not working, and what else you'd like to see!
</Callout>

## Overview

Connect enables you to easily integrate more than {process.env.PUBLIC_APPS}+ APIs directly into your application, letting you make authenticated requests on behalf of your end users, while not having handle authorization grants or refresh tokens yourself, and it includes these features:
1. [Client SDK](https://github.com/PipedreamHQ/pipedream/tree/master/packages/sdk) to initiate authorization for any one of the [{process.env.PUBLIC_APPS}+ APIs](https://pipedream.com/apps) available on Pipedream
2. [REST API](/connected-accounts/api) to retrieve credentials (access token, API key, etc.) for your end users
3. The rest of Pipedream, which includes [a serverless runtime platform](/), [thousands of pre-built source-available triggers and actions](https://github.com/PipedreamHQ/pipedream/tree/master/components), and a first-class developer experience to build, test, and deploy custom workflows

## Getting started

<Steps>

### Enable the feature flag
Enable the feature flag for **Connect** in your Pipedream account: [https://pipedream.com/settings/alpha](https://pipedream.com/settings/alpha)

<Callout type="info">
Please reach out to our team at [connect@pipedream.com](connect@pipedream.com) to enable your account for Connect, once you've enabled the feature flag.
</Callout>

### Verify your application's domain
To integrate the Pipedream SDK on your site, you'll need to verify ownership of your web domain. [Check out the docs](workspaces/domain-verification#pipedream-connect) to get started.

### Configure an OAuth client in Pipedream
To use Pipedream Connect, you'll need to create an OAuth client in Pipedream, for whatever app you want to integrate. [Check out the docs](/connected-accounts/oauth-clients#configuring-custom-oauth-clients) to get started.

### Open your Pipedream project
Open an existing Pipedream project or create a new one: [https://pipedream.com/projects](https://pipedream.com/projects)
- Note your **Project Public Key** and **Project Secret Key** from the **Connect** tab within your project, you'll need these when configuring the SDK and making API requests

### Run the example app
The code for the Pipedream SDK can be found in our [public `pipedream` repo](https://github.com/PipedreamHQ/pipedream), in `/packages/sdk`. Check out the `README` there to get started. 

### Retrieve your user credentials from Pipedream's API
Check out to the API reference below to retrieve your users' credentials from Pipedream's API after they've connected their account.

</Steps>

## Retrieving account details and user credentials
After your end users have connected their account using Pipedream Connect, you can retrieve their credentials using Pipedream's REST API, which enables you to make authenticated requests on their behalf.

### REST API Overview
The base URL for all Connect requests is `https://api.pipedream.com/v1/connect`.

You authenticate to the Connect REST API using **Basic Auth**. Send your Pipedream [Project Public Key]() as the username and the [Project Secret Key]() as the password. When you make API requests, pass an
`Authorization` header of the following format:

```
Authorization: Basic <Base 64 encoded public_key:secret_key>
```

For example, here's how you can use `cURL` to fetch a list of all accounts in your project:

```shell
curl 'https://api.pipedream.com/v1/connect/accounts' \
  -H 'Authorization: Basic <Base 64 encoded public_key:secret_key>'
```

### API Reference

#### List accounts
List all connected accounts for end users within your project

```
GET /accounts/
```

##### Example response

```json
{
  "data": {
    "accounts": [
      {
        "id": "apn_XehyZPr",
        "name": null,
        "healthy": true,
        "dead": false,
        "app": {
          "id": "app_OkrhR1",
          "name": "Slack"
        },
        "created_at": "2024-07-30T22:52:48.000Z",
        "updated_at": "2024-08-01T03:44:17.000Z"
      },
      {
        "id": "apn_b6h9QDK",
        "name": null,
        "healthy": true,
        "dead": false,
        "app": {
          "id": "app_OrZhaO",
          "name": "GitHub"
        },
        "created_at": "2024-07-31T02:49:18.000Z",
        "updated_at": "2024-08-01T03:58:17.000Z"
      },
      {
        "id": "apn_0WhJYxv",
        "name": null,
        "healthy": true,
        "dead": false,
        "app": {
          "id": "app_OrZhaO",
          "name": "GitHub"
        },
        "created_at": "2024-07-31T20:28:16.000Z",
        "updated_at": "2024-08-01T03:47:30.000Z"
      },
      {
        "id": "apn_kVh9PJx",
        "name": null,
        "healthy": true,
        "dead": false,
        "app": {
          "id": "app_OrZhaO",
          "name": "GitHub"
        },
        "created_at": "2024-07-31T21:17:03.000Z",
        "updated_at": "2024-08-01T03:43:23.000Z"
      },
      {
        "id": "apn_WYhMlrz",
        "name": null,
        "healthy": true,
        "dead": false,
        "app": {
          "id": "app_XBxhAl",
          "name": "Airtable"
        },
        "created_at": "2024-08-01T04:04:03.000Z",
        "updated_at": "2024-08-01T04:04:03.000Z"
      }
    ]
  }
}
```

#### List all connected accounts for an app

```
GET /apps/:app_id/accounts
``` 

- `:app_id` can be `oauth_app_id` or `app_id`

##### Example response

```json
[
  {
    "id": "apn_WYhMlrz",
    "name": null,
    "healthy": true,
    "dead": false,
    "app": {
      "id": "oa_aw4ib2",
      "name_slug": "airtable_oauth",
      "name": "Airtable",
      "auth_type": "oauth",
      "description": "Airtable is a low-code platform to build next-gen apps. Move beyond rigid tools, operationalize your critical data, and reimagine workflows with AI.",
      "img_src": "https://assets.pipedream.net/s.v0/app_XBxhAl/logo/orig",
      "custom_fields_json": "[]",
      "categories": ["Productivity"]
    },
    "created_at": "2024-08-01T04:04:03.000Z",
    "updated_at": "2024-08-01T04:04:03.000Z"
  }
]
```

#### Retrieve account details
Retrieve the account details for a specific account

```
GET /accounts/:apn_id
```
- `:apn_id` is the auth provision of the account you want to retrieve
- Optionally include `?include_credentials=1` as a query-string parameter to include the account credentials in the response

##### Example response (without account credentials)

```json
{
  "data": {
    "id": "apn_WYhMlrz",
    "name": null,
    "healthy": true,
    "dead": false,
    "app": {
      "id": "oa_aw4ib2",
      "name_slug": "airtable_oauth",
      "name": "Airtable",
      "auth_type": "oauth",
      "description": "Airtable is a low-code platform to build next-gen apps. Move beyond rigid tools, operationalize your critical data, and reimagine workflows with AI.",
      "img_src": "https://assets.pipedream.net/s.v0/app_XBxhAl/logo/orig",
      "custom_fields_json": "[]",
      "categories": ["Productivity"]
    },
    "created_at": "2024-08-01T04:04:03.000Z",
    "updated_at": "2024-08-01T04:04:03.000Z"
  }
}
```

##### Example Response (with `include_credentials=1`)

```json
{
  "data": {
    "id": "apn_WYhMlrz",
    "name": null,
    "healthy": true,
    "dead": false,
    "app": {
      "id": "app_XBxhAl",
      "name": "Airtable"
    },
    "created_at": "2024-08-01T04:04:03.000Z",
    "updated_at": "2024-08-01T04:04:03.000Z",
    "credentials": {
      "oauth_client_id": "dd7a26ca-ba11-4f80-8667-xxxxxxxx",
      "oauth_access_token": "oaaLa2Ob1umiregWa.v1.xxxxxxxx.xxxxxxxx",
      "oauth_refresh_token": "oaaLa2Ob1umiregWa.v1.refresh.xxxxxxxx",
      "oauth_uid": "usrnbIhrdiaOwPf7q"
    },
    "expires_at": "2024-08-01T05:04:03.000Z",
    "project_id": 279440,
    "user_id": "danny",
    "error": null,
    "last_refreshed_at": null,
    "next_refresh_at": "2024-08-01T04:17:33.000Z"
  }
}
```

#### Delete individual connected account
Delete a specific connected account for an end user

```
DELETE /v1/connect/accounts/:apn_id
```
- `:apn_id` is the auth provision of the account you want to retrieve
- We'll return a `204 No Content` response if the account was successfully deleted

#### Delete all connected accounts for a specific app

`/DELETE /apps/:app_id/accounts`

- `:app_id` can be `oauth_app_id` or `app_id`
- We'll return a `204 No Content` response if the accounts were successfully deleted

#### Delete an end user and all their connected accounts

`DELETE /users/:external_id` 

- `:external_id` corresponds to the the end user's ID in your system
- We'll return a `204 No Content` response if the user was successfully deleted


## Glossary of terms

- **App**: GitHub, Notion, Slack, Google Sheets, etc. — the API you want to make requests to on behalf of your end user. See our full list here: [https://pipedream.com/apps](https://pipedream.com/apps).
- **Connect Partner**: This is probably you — the Pipedream customer who is developing an application and wants to use Pipedream Connect to make authenticated requests on behalf of their end users.
- **Connected Account**: Read more about connected accounts [here](/connected-accounts) — this is the account connection for your end user.
- **End User**: The customer of the Connect Partner and whose data you want to access on their behalf.